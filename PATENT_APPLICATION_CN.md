# 基于手势编码与归一化特征的 AR 交互控制编码系统（专利申请草案）

## 摘要
本发明公开了一种用于 AR 应用的人体手势交互控制系统及配套采样方法与编码规范。系统通过手部关键点检测、坐标归一化与镜像一致性处理，将手势动作映射为可配置的交互效果，并以稳定的 MD5 编码和批次化样品存储结构实现跨项目、跨设备的统一调用。该方案含：采样面板、批次化样品（图像/数据）双目录对齐存储、可扩展的粒子/对象效果编辑与手势控制、以及用于权威证明与完整性校验的 MD5 记录文件。可广泛应用于 AR/VR 交互、游戏引擎、人机交互和手势识别模型训练。

## 技术领域
涉及计算机视觉、人机交互与增强现实（AR），尤其是一种基于手部关键点的手势采样、编码与统一调用的交互控制系统及实现方法。

## 背景技术
传统手势交互存在编码不统一、数据采样分散、镜像与坐标系不一致、效果控制难以复用等问题，难以形成跨项目的通用调用标准。本发明通过统一归一化特征与稳定编码，将采样、存储、控制与编辑整合为一体，显著提升工程落地与扩展性。

## 发明内容（概要）
1. 提供采样面板，采集手势的图像与归一化关键点数据，形成样品集。
2. 采用“手势编号+手势名称”形成稳定唯一的 MD5 编码，作为手势身份标识。
3. 将样品图片与样品数据分别存储于同一手势目录的不同子文件夹（`images/`、`data/`），文件名一致。
4. 在该目录下维护 `samples.md5` 文件，记录每个样品图片与数据的 MD5 校验及相对路径，保证真实性与可证据性。
5. 在运行时对视频、骨架与特效采用一致的镜像与坐标系处理，使视觉与交互方向一致。
6. 将手势映射到可配置的交互场景，并支持编辑参数与手势联动。
7. 以统一的特征格式（掌心居中、按手掌尺度归一化）实现跨项目的通用调用。
8. 支持按手势名称制作的批次数据文件（数据+图片分目录，文件名一致），并以 `samples.md5` 持续追加校验记录，形成完整证据链。

## 权利要求书（示例）
1. 一种用于 AR 应用的手势交互控制的手势编码系统，包括：手部关键坐标一致、坐标归一化、镜像一致性渲染、可配置控制、采样与编码存储的统一调用，其中：
   - 坐标归一化以掌心中心为原点、以腕部到中指 MCP 距离为尺度；
   - 镜像一致性对视频、骨架叠加与效果渲染采用同一坐标变换；
   - 采样与编码存储采用“手势编号+手势名称”的 MD5 作为手势编码，并将样品图片与样品数据分别存储于同一目录的不同子文件夹。
2. 根据权利要求 1 所述系统，其中采样存储模块在每次样品保存后，自动更新同目录下的 `samples.md5` 文件，新增两条记录，分别对应样品图片与数据的 MD5 与相对路径。
3. 根据权利要求 1 或 2 所述系统，其中样品数据包含 21 个手部关键点的归一化特征，格式为 `[x1', y1', x2', y2', …]`。
4. 根据权利要求 1 至 3 任一所述系统，其中手势编码为 `MD5(id:name)`，用于跨项目与批次的统一映射。
5. 根据权利要求 1 至 4 任一所述系统，其中可配置效果控制模块支持以手势控制对象的平移、缩放、旋转与刷新，并通过编辑面板动态配置参数范围（生成速率、重力、速度、尺寸、色相、旋涡强度等）。
6. 根据权利要求 1 至 5 任一所述系统，其中镜像一致性渲染通过在渲染阶段对画布应用 `translate(width,0) + scale(-1,1)`，确保视觉方向与交互方向一致。
7. 一种基于所述系统的手势采样方法，包括：采样前选择保存目录、输入手势编号与名称、采集中点击采样按钮生成样品（图像与数据），完成记录后以手势名称为目录名存储批次样品，并生成/更新 MD5 记录文件。
8. 根据权利要求 7 所述方法，其中样品图片裁剪基于关键点的包围盒并缩放为固定尺寸以便展示与训练。
9. 根据权利要求 7 或 8 所述方法，其中支持样品的查看、重采样与删除，并在完成记录时将所有样品写入 `images/`、`data/` 子目录，文件名一致。
10. 根据权利要求 1 至 9 任一所述系统或方法，其中采用统一的数据结构与 MD5 记录文件可证明样品的完整性与不可篡改性，便于专利证据链与工程交付。
11. 一种手势到 AR 控制的映射方法，其中将手势编码（`MD5(id:name)`) 映射到 AR 引擎事件集（平移、缩放、旋转、刷新、颜色变换、参数编辑调用），并通过统一的接口在运行时装载对应配置。
12. 根据权利要求 11 所述方法，其中映射配置可通过编辑面板实时调整并持久化，支持参数范围与默认值 Schema。

## 附图说明（示例）
图 1：系统架构图（摄像头输入、手势识别、归一化、镜像渲染、效果控制、采样与编码存储）。  
图 2：采样面板界面（图像区、数据属性面板、样品列表与操作）。  
图 3：批次化目录结构与 `samples.md5` 记录文件示意。  
图 4：手势与效果映射关系（OpenPalm/Pinch/Victory/Point/Fist 与平移/缩放/旋转/刷新）。
图 5：坐标归一化示意（掌心中心与尺度定义）。  
图 6：镜像一致性渲染示意（画布坐标变换）。  
图 7：样品文件名对齐与 MD5 校验流程图。

## 具体实施方式（与代码对应）
- 关键点与指组映射：`src/gesture.ts:3-8`  
  用于基于距离比与组合规则的手势判定（伸展、捏合、单指、双指等）。
- 像素坐标转换：`src/handsPipeline.ts:17-20`  
  将归一化坐标转换到画布尺寸。
- 镜像一致性：  
  视频镜像：`src/main.ts:42-51`；骨架镜像：`src/main.ts:83-95`；特效镜像：`src/main.ts:129-137`；采样页镜像：`src/record.ts:49-59, 218-226`。
- 归一化特征与掌心/尺度：`src/recorder.ts:21-41`  
  掌心中心为 `{0,5,9,13,17}` 的平均；尺度为 `distance(0,9)`。
- 批次化样品与双目录对齐存储、MD5 记录：`src/recorder.ts:191-241`  
  在 `gestures/<name>/` 下分别写入 `images/` 与 `data/`，更新 `samples.md5`。
- 采样面板逻辑：`record.html`、`src/record.ts:244-280`  
  采样、查看、重采样、删除、完成记录。
- 效果控制与编辑：`src/particles.ts`、`src/effectsRegistry.ts`、`src/ui.ts`  
  支持参数编辑与手势联动。
 - AR 映射接口与事件：见“AR 映射与编码规范”文档。

## 编码与数据目录（外部采样）
- 采样输出目录示例：`handcode\gestures\`  
  其中每个手势采用单独目录（如 `Victory/`），包含：
  - `images/sample-<n>-<hash8>.png`
  - `data/sample-<n>-<hash8>.json`
  - `samples.md5`（图片与数据 MD5 校验记录）
  - `meta.json`（批次信息）
- 汇总目录引用：详见本仓库根目录 `HAND_LANDMARKS.md`。
 - 若用于专利附送样品集，建议同时提交 `samples.md5` 与示例 JSON/PNG 文件，确保可验证性。

## 创新点与优势
1. 统一的归一化坐标与稳定编码，形成可复用的手势数据标准。  
2. 图像/数据双目录对齐与 MD5 记录，提供工程可用的证据链与完整性保障。  
3. 镜像一致性渲染，确保用户视觉与交互方向一致。  
4. 可配置效果与手势联动，适配 AR 控制的多维参数。  
5. 模块化接口，便于后续扩展新手势、新效果与新采样策略。
6. 采样视图与属性面板联动，支持样品浏览、改删、重采样与批次化输出，提升工程效率。

## 可扩展性
- 稳态采样与均值特征；多手支持；批次合并与增量采样；跨平台导入导出。  
- 与 AR 引擎（Unity/Unreal/WebXR）对接：以手势编码映射到引擎内交互事件。

## 申请文件附注
本草案为技术与实现层面的专利申请初稿，建议由代理机构按目标国家/地区的专利法规范进一步整理权利要求与附图。
